## Dvoˇr´ak–Dell–Grohe–Rattan theorem via an asymptotic argument

Alexander Kozachinskiy<sup>∗</sup>

Centro Nacional de Inteligencia Artificial, Chile

## Abstract

Two graphs G1, G<sup>2</sup> are distinguished by the Weisfeiler–Leman isomorphism test if and only if there is a tree T that has a different number of homomorphisms to G<sup>1</sup> and to G2. There are two known proofs of this fact – a logical proof by Dvoˇr´ak and a linear-algebraic proof by Dell, Grohe, and Rattan. We give another simple proof, based on ordering WL-labels and asymptotic arguments.

The Weisfeiler–Leman (WL) test [\[3\]](#page-2-0) is an algorithm meant for checking if two given graphs G<sup>1</sup> and G<sup>2</sup> are isomorphic. It works as follows. First, one defines a notion of the k-level WL-label of a node of a graph, inductively over k. For k = 0, all nodes in all graphs have the same 0-level WL-label. Now, the (k + 1)-level WL-label of a node is the multiset of k-level WL-labels of its neighbors. Two graphs G<sup>1</sup> and G<sup>2</sup> are distinguished by the WL-test if for some k, they have different multisets of k-level WL-labels of their nodes.

This is a sound isomorphism test (isomorphic graphs cannot be distinguished) but not complete – for instance, a hexagon will not be distinguished from two disjoint triangles. It is known that two graphs G<sup>1</sup> and G<sup>2</sup> are distinguished by the WL test if and only if there exists a tree T such that there is a different number of homomorphisms from T to G<sup>1</sup> and from T to G2. Here by a homomorphism from a graph H to a graph G we mean a mapping from the set of nodes of H to the set of nodes of G such that adjacent nodes in H are mapped to adjacent nodes in G. This result was first proved by Dvoˇr´ak [\[2\]](#page-2-1) using a logical argument, and then re-discovered by Dell, Grohe, and Rattan [\[1\]](#page-2-2) with a linear-algebraic argument.

There is a simple direction of this theorem – if there is a tree T that has a different number of homomorphisms to G<sup>1</sup> and G2, then G<sup>1</sup> and G<sup>2</sup> are distinguished by the WL test. This follows from an observation that the k-level WL-label ℓk(u) of a node u in a graph G uniquely determines the number h(T, ℓk(u)) of homomorphisms from a depth-k tree T with an indicated "root" to G such that the root goes to u. Hence, for a k-depth tree T, if we arbitrarily choose one of its nodes as a root, the number of homomorphisms from T to a graph G = (V, E) is:

$$
\sum_{u\in V}h(T,\ell_k(u)).
$$

If for some depth-k tree T and for two graphs G<sup>1</sup> = (V1, E1), G<sup>2</sup> = (V2, E2), we have:

$$
\sum_{u_1 \in V_1} h(T, \ell_k(u)) \neq \sum_{u_2 \in V_2} h(T, \ell_k(u_2)),
$$

then the multisets of k-level WL-labels of the nodes of G<sup>1</sup> and G<sup>2</sup> have to be different.

We now establish the hard direction via a new argument.

Theorem 1. If two graphs G<sup>1</sup> and G<sup>2</sup> are distinguished by the WL test, then there is a tree T that has a different number of homomorphisms to G<sup>1</sup> and to G2.

<sup>∗</sup>alexander.kozachinskyi@cenia.cl. Supported by the ANID Fondecyt Iniciaci´on grant 11250060 and National Center for Artificial Intelligence CENIA FB210017, Basal ANID.

Proof. For the proof, we define, for any k, a linear order on k-level WL-labels. For k = 0, there is just one possible label, so there is nothing to define. For k = 1, each label is identified with a natural number (degree of a node in a graph). The larger this number is, the larger we put the label in our order.

More generally, assume we have already defined the order on k-level labels. We extend it to (k + 1)-level labels "lexicographically". Namely, (k + 1)-level labels are multisets of k-level labels. Now, we take two (k + 1)-labels ℓ<sup>1</sup> and ℓ<sup>2</sup> that we want to "compare". There is already an order on their elements (these elements are k-level labels). We take the largest element that appears a different number of times in the multisets ℓ<sup>1</sup> and ℓ2. The multiset that has this element more times is defined to be the larger one. This is clearly a linear order.

<span id="page-1-1"></span>Lemma 1. For any finite set S of W L-labels that does not have labels of isolated nodes, and for any k, there exists a sequence of k-depth rooted trees {T k <sup>n</sup> }n→∞ such that for any two k-level labels ℓ1, ℓ<sup>2</sup> ∈ S, we have:

<span id="page-1-2"></span>
$$
\ell_1 < \ell_2 \implies h(T_n^k, \ell_1) = o(h(T_n^k, \ell_2)) \text{ as } n \to \infty. \tag{1}
$$

Let us first deduce the theorem from the lemma. Take any two graphs G<sup>1</sup> and G<sup>2</sup> that are distinguished after the k-th iteration of the WL-test. Assume first, for simplicity, that G<sup>1</sup> and G<sup>2</sup> do not have isolated nodes. We apply the lemma to the set Lof k-level WL labels that appear in G<sup>1</sup> and G2. We will show that one of the trees T k <sup>n</sup> distinguishes G<sup>1</sup> and G<sup>2</sup> by the number of homomorphisms from it (as from a non-rooted tree). Indeed, the number of homomorphisms from T k n to a graph G can be counted as the sum over vertices v of G, of the number of homomorphisms from T k n to G that map the root to v. Hence, it is enough to show that for a large enough n, we have:

<span id="page-1-0"></span>
$$
\sum_{v \in V(G_1)} h(T_n^k, \ell^k(v)) \neq \sum_{v \in V(G_2)} h(T_n^k, \ell^k(v)).
$$
\n(2)

Graphs G<sup>1</sup> and G<sup>2</sup> have different multisets of k-level labels. Consider the largest (in our "lexicographic" order) k-level label ℓ that appears a different number of times in them. Let us say, it appears more in G1. If we consider the difference between the left-hand side and the right-hand side in [\(2\)](#page-1-0), all terms corresponding to labels that are larger than ℓ will cancel out. In turn, h(T k n , ℓ) will be with a positive coefficient in this difference, and h(T k n , ℓ) is itself strictly positive because ℓ is for a non-isolated node. Hence, for large enough n, the difference will be strictly positive. Indeed, terms h(T k n , ℓ1) for ℓ<sup>1</sup> < ℓ can have negative coefficients, but because these terms are dominated by h(T k n , ℓ), this will not prevent the difference from being positive in the limit.

What if G<sup>1</sup> and G<sup>2</sup> have isolated nodes? Then in [\(2\)](#page-1-0), some terms are 0s, corresponding to isolated nodes. If the multisets of non-isolated nodes are different, the same argument as before applies. If they are the same, then the graphs have to differ just in the number of nodes, in which case we can distinguish them by the number of homomorphisms from a single isolated node.

Proof of Lemma [1.](#page-1-1) Let us first establish the lemma for k = 1. We will let T 1 <sup>n</sup> be just a star with n children. There are d <sup>n</sup> homomorphisms from T 1 n to a node of degree d that map the root to this node (for every child of the root, there are d options). Since d n <sup>1</sup> = o(d n 2 ) for 1 ≤ d<sup>1</sup> < d2, the induction base follows.

We now perform the induction step. Assume that the statement is proved for k. First, let us for every n define a tree H<sup>n</sup> of depth k + 1 where the root has one child whose subtree is T k n . Let L be a (k + 1)-level WL-label, i.e., a multiset of some k-level WL-labels ℓ. We have:

$$
h(H_n, L) = \sum_{\ell \in L} h(T_n^k, \ell).
$$

Indeed, if v is a node with label L, then we have to map the unique child of the root of H<sup>n</sup> to some neighbor of v. Upon choosing this neighbor, we have to map T k n to this neighbor, and the number of ways to do that is h(T k n , ℓ), where ℓ is the k-level WL-label of this neighbor. And by definition, the multiset of k-level WL-labels of neighbors of v is L.

Now, there exists m such that h(Hm, L1) < h(Hm, L2) for all L<sup>1</sup> < L<sup>2</sup> ∈ S. Indeed, based on the condition [\(1\)](#page-1-2) for level k, we have for any two fixed L1, L<sup>2</sup> ∈ S with L<sup>1</sup> < L<sup>2</sup>

$$
h(H_n, L_1) < h(H_n, L_2)
$$

for all large enough n (we consider the largest k-level label ℓ that appears a different number of times in L<sup>1</sup> and L2, there are fewer of them in L1, so the difference h(Hn, L2) − h(Hn, L1) includes this term with a positive coefficient, this term is itself positive because of the assumption about not having isolated nodes, and all other terms are dominated by it). There are finitely many labels in S, so it remains to take m large enough so that this inequality holds for all pairs in question.

What remains to do is to define T (k+1) <sup>n</sup> as a depth-(k+1) tree where the root has n children, each followed by T k <sup>m</sup> (or, in other words, n copies of Hm, glued by the root). Observe that

$$
h(T_n^{k+1}, L) = h(H_m, L)^n.
$$

Taking any two L1, L<sup>2</sup> ∈ S with L<sup>1</sup> < L2, since h(Hm, L1) < h(Hm, L2), we obtain:

$$
h(T_n^{k+1}, L_1) = h(H_m, L_1)^n = o(h(H_m, L_2)^n) = o(h(T_n^{k+1}, L_2)),
$$

as required.

## References

- <span id="page-2-2"></span>[1] Dell, H., Grohe, M., and Rattan, G. Lov´asz meets weisfeiler and leman. In 45th International Colloquium on Automata, Languages, and Programming (ICALP 2018) (2018), Schloss Dagstuhl–Leibniz-Zentrum f¨ur Informatik, pp. 40–1.
- <span id="page-2-1"></span>[2] Dvorˇak, Z. ´ On recognizing graphs by numbers of homomorphisms. Journal of Graph Theory 64, 4 (2010), 330–342.
- <span id="page-2-0"></span>[3] Weisfeiler, B., and Leman, A. The reduction of a graph to canonical form and the algebra which appears therein. nti, Series 2, 9 (1968), 12–16.